---
title: "Googleのソフトウェアエンジニアリングから学ぶコードレビュー"
emoji: "🦩"
type: "idea" # tech: 技術記事 / idea: アイデア
topics: [コードレビュー]
published: false
---

オライリー・ジャパンから「Googleのソフトウェアエンジニアリング」という翻訳の書籍が発売され、その中からコードレビューに関する箇所を読んで学んだことの紹介です。

https://www.oreilly.co.jp/books/9784873119656/

第9章がコードレビューに費やされています。
その中で一番印象に残ったのはコードレビューの恩恵について書かれた次の一節です。

> 通常はコードレビューが、作者以外の者がコード変更を検証する初めての機会である。こうした観点によってレビュアーには、最も優れたエンジニアですらできないことができるようになる。それは、コード作者の観点から生じるバイアスに影響されないフィードバックを提供することだ。**コードレビューは、ある変更がより広い対象にとって理解可能かどうか試す最初の試練であることが多い**。コードは書かれるより読まれる回数が多くなるため、この観点は生死を分けるほどに重要であり、理解と意味の把握が決定的に重要である。

この章では繰り返し、 **理解と意味の把握** といった点について表現を変えて伝えているように感じました。

コード作者の手から離れて、別の誰かがメンテナンス可能な状態になっているか、それを確認する作業がコードレビューという位置付けです。

Googleにおいてもコードレビューで得られる恩恵の一つとしてコードの正しさを挙げており、本書を読む前はこれが最重要だと考えていました。
しかし、コードレビューのプロセスにおいてコードの正しさを担保するのは難しく、実際に細心の注意をしても見逃すことはあり得ます。

> コードレビューは、コードの正しさについての万能の解決策でも唯一のチェック方法でもなく、ソフトウェアをめぐるそのような問題に対抗する多層防御の一要素である。結果として、コードレビューが成果を上げるためには「完璧」である必要はない。
　実に意外なことに、コードの正しさのチェックは、コードレビューのプロセスからGoogleが得る恩恵の首位ではない。コードの正しさのチェックは一般的に、コード変更が動作することを保証する。だが、時間が経ちコードベース自体がスケールした場合もコードの変更が理解可能で意味を成すと保証することの方が、意義が大きい。

また作者を尊重し、レビュアーは **質問** することを推奨しています。

> コードレビュープロセスにおける、フィードバックと確認を行う段階では、変更がその特定の方法で行われているのは何故かという質問を投げかける必要がある。この情報交換が、知識共有を促進するのだ。実際、多くのコードレビューには双方向の情報交換が伴う。作者もレビュワーも、レビューツール自体の中で作者に編集提案を直接共有しても差し支えない。

> 一般に、レビュアーはコード作者の特定アプローチについて作者を尊重すべきであり、作者のアプローチが不十分な場合にのみ代案の指摘を行うべきだ。作者が同等の妥当なアプローチをいくつか示せるなら、レビュアーはその作者の選好を受け入れるべきである。

> そのアプローチが間違っていると決めてかかる前に、何故そのようなアプローチが採られたかについて質問した方がよい。

**迅速に** に行われることについても言及されています。
24（勤務）時間以内なので、8時間ペースなら3営業日は妥当なラインだと思います。

> レビュアーは、迅速にフィードバックを行うべきである。Googleでは、24（勤務）時間以内にコードレビューからのフィードバックが行われることが期待される。レビュアーがその時間内にレビューを完了できないなら、変更を少なくとも目にしてはいてできるだけ早くレビューに着手予定であると返信するのが、良い（そして期待される）プラクティスである。

**断片的な返信を避ける** ことも重要な要素としています。

> レビュアーは、コードレビューに少しずつ断片的に返信することも避けるべきだ。レビュープロセスでは、レビューでフィードバックを得て対処してから無関係なフィードバックをさらに受け続けることほど、コード作者にとって苛立たしいことも滅多にない

レビュアーがコード作者を尊重する前提として、コード作者側に、作成時点の責務を担うことを期待しています。提案されたコードはレビュアーと共有することで作者の責務ではなく、チームの責務になります。チームの責務にして良いものなのか、その判断においてはコード作者の責務として期待しているということになります。

> 自分が提案するコードは「自分のもの」ではなくチームのものであることを思い出してほしい。コードベースにそのコードをチェックインした後は、いかなる場合でもそのコードはもはや自分のものではない。自分のアプローチについての質問を歓迎し、自分がある特定の方法で物事を処理した理由を説明する心構えをしておくべきだ。作者が担う責務が、将来にわたりそのコードが理解可能で保守性があるよう保証するという要素を含むことを、肝に銘じておかなければならない。

そして、これらを実現するために **小さな変更を書け** というのが重要なプラクティスです。

> コードレビューのプロセスを機敏なものに保つ上で最も重要なプラクティスはおそらく、変更を小さくとどめておくことだ。理想的にはコードレビューは、レビュアーと作者双方のために、噛み砕いて理解することが容易で、かつただ1つの問題に集中したものであるべきだ。
